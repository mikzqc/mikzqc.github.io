<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Custom font for the display */
        .font-orbitron {
            font-family: 'Orbitron', sans-serif;
        }
        /* Custom font for buttons */
        .font-inter {
            font-family: 'Inter', sans-serif;
        }
        /* Prevents highlighting text on fast clicks */
        .calculator-button {
            user-select: none;
            -webkit-user-select: none; /* For Safari */
            -moz-user-select: none;    /* For Firefox */
            -ms-user-select: none;     /* For Internet Explorer/Edge */
        }
        /* Custom focus ring for accessibility */
        .calculator-button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.5); /* A soft blue glow */
        }
    </style>
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen font-inter">

    <div class="w-full max-w-sm mx-auto bg-gray-800 rounded-2xl shadow-2xl p-4 space-y-4">
        <!-- Calculator Display -->
        <div class="bg-gray-900/50 rounded-lg p-4 text-right break-words">
            <div id="expression" class="text-gray-400 text-xl h-7 font-orbitron"></div>
            <div id="display" class="text-white text-5xl font-orbitron">0</div>
        </div>

        <!-- Calculator Buttons -->
        <div class="grid grid-cols-4 gap-3">
            <!-- Row 1 -->
            <button class="calculator-button bg-rose-500 hover:bg-rose-600 active:bg-rose-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="clear">AC</button>
            <button class="calculator-button bg-gray-600 hover:bg-gray-700 active:bg-gray-800 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="backspace">DEL</button>
            <button class="calculator-button bg-gray-600 hover:bg-gray-700 active:bg-gray-800 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="%">%</button>
            <button class="calculator-button bg-amber-500 hover:bg-amber-600 active:bg-amber-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="/">÷</button>

            <!-- Row 2 -->
            <button class="calculator-button bg-gray-700 hover:bg-gray-600 active:bg-gray-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="7">7</button>
            <button class="calculator-button bg-gray-700 hover:bg-gray-600 active:bg-gray-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="8">8</button>
            <button class="calculator-button bg-gray-700 hover:bg-gray-600 active:bg-gray-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="9">9</button>
            <button class="calculator-button bg-amber-500 hover:bg-amber-600 active:bg-amber-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="*">×</button>

            <!-- Row 3 -->
            <button class="calculator-button bg-gray-700 hover:bg-gray-600 active:bg-gray-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="4">4</button>
            <button class="calculator-button bg-gray-700 hover:bg-gray-600 active:bg-gray-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="5">5</button>
            <button class="calculator-button bg-gray-700 hover:bg-gray-600 active:bg-gray-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="6">6</button>
            <button class="calculator-button bg-amber-500 hover:bg-amber-600 active:bg-amber-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="-">−</button>

            <!-- Row 4 -->
            <button class="calculator-button bg-gray-700 hover:bg-gray-600 active:bg-gray-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="1">1</button>
            <button class="calculator-button bg-gray-700 hover:bg-gray-600 active:bg-gray-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="2">2</button>
            <button class="calculator-button bg-gray-700 hover:bg-gray-600 active:bg-gray-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="3">3</button>
            <button class="calculator-button bg-amber-500 hover:bg-amber-600 active:bg-amber-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="+">+</button>

            <!-- Row 5 -->
            <button class="calculator-button bg-gray-700 hover:bg-gray-600 active:bg-gray-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150 col-span-2" data-key="0">0</button>
            <button class="calculator-button bg-gray-700 hover:bg-gray-600 active:bg-gray-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key=".">.</button>
            <button class="calculator-button bg-sky-500 hover:bg-sky-600 active:bg-sky-700 text-white p-4 text-2xl font-bold rounded-lg transition-all duration-150" data-key="=">=</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const display = document.getElementById('display');
            const expressionDiv = document.getElementById('expression');
            const buttons = document.querySelectorAll('.calculator-button');

            let currentInput = '0';
            let expression = '';
            let hasCalculated = false;

            // Function to update the display
            const updateDisplay = () => {
                display.textContent = currentInput;
                expressionDiv.textContent = expression.replace(/\*/g, '×').replace(/\//g, '÷');
            };

            // Function to handle button clicks
            const handleInput = (key) => {
                const isNumber = !isNaN(parseInt(key));
                const isOperator = ['+', '-', '*', '/', '%'].includes(key);
                
                if (hasCalculated && !isOperator && key !== '=') {
                    // Start a new calculation after '='
                    currentInput = '0';
                    expression = '';
                    hasCalculated = false;
                }

                if (isNumber) {
                    if (currentInput === '0' || hasCalculated) {
                        currentInput = key;
                        hasCalculated = false;
                    } else {
                        currentInput += key;
                    }
                } else if (key === '.') {
                    // Prevent multiple decimal points in one number
                    if (!currentInput.includes('.')) {
                        currentInput += '.';
                    }
                } else if (isOperator) {
                    if (currentInput === 'Error') return;
                    // Append current input and operator to expression
                    expression += currentInput + key;
                    currentInput = '0';
                    hasCalculated = false;
                } else if (key === '=') {
                    if(expression === '' && currentInput === '0') return;
                    
                    expression += currentInput;
                    try {
                        // Using a function to evaluate is safer than direct eval
                        const result = new Function('return ' + expression.replace(/%/g, '/100*'))();

                        if (!isFinite(result)) {
                           throw new Error("Division by zero");
                        }
                        
                        // Format result to a reasonable number of decimal places
                        currentInput = parseFloat(result.toPrecision(12)).toString();
                        expression += ' =';
                        hasCalculated = true;

                    } catch (error) {
                        currentInput = 'Error';
                        expression = '';
                    }
                } else if (key === 'clear') {
                    currentInput = '0';
                    expression = '';
                    hasCalculated = false;
                } else if (key === 'backspace') {
                    if (currentInput === 'Error' || hasCalculated) {
                        // If there's an error or after a calculation, backspace should clear
                        currentInput = '0';
                        expression = '';
                        hasCalculated = false;
                    } else if (currentInput.length > 1) {
                        currentInput = currentInput.slice(0, -1);
                    } else {
                        currentInput = '0';
                    }
                }
                
                updateDisplay();
            };

            // Add event listeners to all buttons
            buttons.forEach(button => {
                button.addEventListener('click', () => handleInput(button.dataset.key));
            });

            // Add keyboard support
            document.addEventListener('keydown', (event) => {
                let key = event.key;
                
                // Map keyboard keys to calculator keys
                if (key === 'Enter') key = '=';
                if (key === 'Backspace') key = 'backspace';
                if (key === 'Escape') key = 'clear';
                if (key === 'x' || key === 'X') key = '*';
                if (key === 'd' || key === '/') key = '/';


                const button = document.querySelector(`.calculator-button[data-key="${key}"]`);
                if (button) {
                    event.preventDefault(); // Prevent default browser actions
                    button.click();
                    // Add a visual feedback for key press
                    button.classList.add('bg-gray-500');
                    setTimeout(() => button.classList.remove('bg-gray-500'), 100);
                }
            });

            // Initialize the display
            updateDisplay();
        });
    </script>

</body>
</html>
