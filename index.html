<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asteroid Shooter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the game */
        body {
            font-family: 'Orbitron', sans-serif;
            background-color: #0c0a18;
            color: #e0e0e0;
            overflow: hidden; /* Prevents scrollbars from appearing */
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }
        canvas {
            background-color: #000;
            display: block;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(76, 209, 255, 0.5);
            cursor: none; /* Hide cursor over game area */
        }
        .game-container {
            width: 100%;
            max-width: 800px; /* Max width of the game area */
            margin: auto;
            text-align: center;
        }
        .ui-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: rgba(0,0,0,0.3);
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        #restartButton {
            display: none; /* Hidden by default */
            background: linear-gradient(145deg, #f97316, #ea580c);
            color: white;
            padding: 1rem 2rem;
            border-radius: 9999px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.4);
        }
        #restartButton:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(249, 115, 22, 0.6);
        }
        #gameOverModal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(12, 10, 24, 0.85);
            padding: 2rem 3rem;
            border-radius: 1rem;
            text-align: center;
            color: white;
            display: none; /* Initially hidden */
            flex-direction: column;
            gap: 1.5rem;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <div class="game-container p-4">
        <!-- UI Panel for Score and Title -->
        <div class="ui-panel">
            <h1 class="text-2xl md:text-3xl font-bold text-cyan-300">ASTEROID SHOOTER</h1>
            <div id="scoreContainer" class="text-xl md:text-2xl font-bold">Score: <span id="scoreEl">0</span></div>
        </div>
        
        <!-- The Game Canvas -->
        <canvas id="gameCanvas"></canvas>

        <!-- Game Over Modal -->
        <div id="gameOverModal">
            <h2 class="text-4xl font-bold text-red-500">GAME OVER</h2>
            <p class="text-2xl">Final Score: <span id="finalScoreEl">0</span></p>
            <button id="restartButton">Restart Game</button>
        </div>
    </div>

    <script>
        // --- DOM ELEMENT SELECTION ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('scoreEl');
        const finalScoreEl = document.getElementById('finalScoreEl');
        const gameOverModal = document.getElementById('gameOverModal');
        const restartButton = document.getElementById('restartButton');

        // --- GAME CONFIGURATION ---
        let score = 0;
        let gameRunning = true;
        let animationId;
        const keys = {
            right: { pressed: false },
            left: { pressed: false },
            space: { pressed: false }
        };

        // --- INITIAL CANVAS SETUP ---
        // Set canvas to fill its container width, and set a common aspect ratio
        const aspectRatio = 16 / 9;
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = canvas.width / aspectRatio;

            // Make sure height does not exceed window height
            if (canvas.height > window.innerHeight * 0.75) {
                canvas.height = window.innerHeight * 0.75;
                canvas.width = canvas.height * aspectRatio;
            }
        }

        window.addEventListener('load', () => {
             resizeCanvas();
             init(); // Initialize the game state
             animate(); // Start the game loop
        });
        window.addEventListener('resize', resizeCanvas);


        // --- PLAYER CLASS ---
        class Player {
            constructor() {
                this.speed = 7;
                this.width = 50;
                this.height = 30;
                this.position = {
                    x: canvas.width / 2 - this.width / 2,
                    y: canvas.height - this.height - 20
                };
                this.velocity = { x: 0, y: 0 };
                this.shootCooldown = 0;
                this.isShooting = false;
            }

            draw() {
                // Draws the player's spaceship as a triangle
                ctx.fillStyle = 'cyan';
                ctx.beginPath();
                ctx.moveTo(this.position.x + this.width / 2, this.position.y);
                ctx.lineTo(this.position.x, this.position.y + this.height);
                ctx.lineTo(this.position.x + this.width, this.position.y + this.height);
                ctx.closePath();
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.stroke();
            }

            update() {
                // Update player position based on velocity
                this.position.x += this.velocity.x;

                // Enforce screen boundaries
                if (this.position.x < 0) {
                    this.position.x = 0;
                } else if (this.position.x + this.width > canvas.width) {
                    this.position.x = canvas.width - this.width;
                }
                
                // Handle shooting
                if(this.shootCooldown > 0) this.shootCooldown--;
                if(this.isShooting && this.shootCooldown === 0) {
                    bullets.push(new Bullet({
                        position: { x: this.position.x + this.width / 2, y: this.position.y },
                        velocity: { x: 0, y: -10 }
                    }));
                    this.shootCooldown = 15; // Cooldown frames between shots
                }

                this.draw();
            }
        }

        // --- BULLET CLASS ---
        class Bullet {
            constructor({ position, velocity }) {
                this.position = position;
                this.velocity = velocity;
                this.width = 4;
                this.height = 10;
            }

            draw() {
                ctx.fillStyle = 'yellow';
                ctx.fillRect(this.position.x - this.width/2, this.position.y, this.width, this.height);
            }

            update() {
                this.position.y += this.velocity.y;
                this.draw();
            }
        }
        
        // --- ASTEROID CLASS ---
        class Asteroid {
            constructor({ position, velocity, radius }) {
                this.position = position;
                this.velocity = velocity;
                this.radius = radius;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.position.x, this.position.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = '#a0a0a0'; // Grey color for asteroids
                ctx.fill();
                ctx.strokeStyle = '#c0c0c0';
                ctx.stroke();
            }

            update() {
                this.position.x += this.velocity.x;
                this.position.y += this.velocity.y;
                this.draw();
            }
        }

        // --- PARTICLE CLASS (for explosion effects) ---
        class Particle {
            constructor({ position, velocity, radius, color, fades }) {
                this.position = position;
                this.velocity = velocity;
                this.radius = radius;
                this.color = color;
                this.opacity = 1;
                this.fades = fades;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.opacity;
                ctx.beginPath();
                ctx.arc(this.position.x, this.position.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.restore();
            }
            
            update() {
                this.position.x += this.velocity.x;
                this.position.y += this.velocity.y;
                if(this.fades) this.opacity -= 0.02;
                this.draw();
            }
        }


        // --- GAME STATE VARIABLES ---
        let player;
        let bullets;
        let asteroids;
        let particles;
        let frames;

        // --- INITIALIZATION FUNCTION ---
        function init() {
            player = new Player();
            bullets = [];
            asteroids = [];
            particles = [];
            frames = 0;
            score = 0;
            gameRunning = true;
            scoreEl.textContent = 0;
            gameOverModal.style.display = 'none';
        }


        // --- PARTICLE CREATION ---
        function createParticles(asteroid) {
            for(let i=0; i < 15; i++) {
                particles.push(new Particle({
                    position: { x: asteroid.position.x, y: asteroid.position.y },
                    velocity: { 
                        x: (Math.random() - 0.5) * 3, 
                        y: (Math.random() - 0.5) * 3
                    },
                    radius: Math.random() * 3,
                    color: '#a0a0a0',
                    fades: true
                }));
            }
        }

        // --- THE MAIN GAME LOOP ---
        function animate() {
            if (!gameRunning) return;

            animationId = requestAnimationFrame(animate);

            // Clear canvas with a space-like background
            ctx.fillStyle = 'rgba(12, 10, 24, 0.3)'; // Semi-transparent for motion blur effect
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Update player
            player.update();

            // Update particles and remove faded ones
            particles.forEach((particle, i) => {
                if (particle.opacity <= 0) {
                    setTimeout(() => particles.splice(i, 1), 0);
                } else {
                    particle.update();
                }
            });

            // Update bullets and remove off-screen ones
            bullets.forEach((bullet, index) => {
                if (bullet.position.y + bullet.height < 0) {
                    setTimeout(() => bullets.splice(index, 1), 0);
                } else {
                    bullet.update();
                }
            });

            // Spawn asteroids periodically
            if (frames % 60 === 0) { // Spawn every 60 frames (1 second)
                const radius = Math.random() * (30 - 10) + 10;
                asteroids.push(new Asteroid({
                    position: {
                        x: Math.random() * canvas.width,
                        y: -radius
                    },
                    velocity: {
                        x: (Math.random() - 0.5) * 2,
                        y: Math.random() * 2 + 1
                    },
                    radius: radius
                }));
            }
            
            // Update asteroids and check for collisions
            asteroids.forEach((asteroid, astIndex) => {
                asteroid.update();

                // Collision: Player vs Asteroid -> Game Over
                const dist = Math.hypot(player.position.x + player.width / 2 - asteroid.position.x, player.position.y + player.height / 2 - asteroid.position.y);
                if (dist - asteroid.radius - player.width/2 < 1) {
                    endGame();
                }

                // Collision: Bullet vs Asteroid
                bullets.forEach((bullet, bulIndex) => {
                    const dist = Math.hypot(bullet.position.x - asteroid.position.x, bullet.position.y - asteroid.position.y);
                    if (dist - asteroid.radius - bullet.width < 1) {
                        
                        // Increase score
                        score += 100;
                        scoreEl.textContent = score;

                        // Create explosion
                        createParticles(asteroid);

                        // Safely remove asteroid and bullet
                        setTimeout(() => {
                            asteroids.splice(astIndex, 1);
                            bullets.splice(bulIndex, 1);
                        }, 0);
                    }
                });
            });

            // Player movement logic
            if (keys.left.pressed && player.position.x > 0) {
                player.velocity.x = -player.speed;
            } else if (keys.right.pressed && player.position.x + player.width < canvas.width) {
                player.velocity.x = player.speed;
            } else {
                player.velocity.x = 0;
            }

            frames++;
        }

        // --- END GAME FUNCTION ---
        function endGame() {
            gameRunning = false;
            cancelAnimationFrame(animationId);
            finalScoreEl.textContent = score;
            gameOverModal.style.display = 'flex';
            restartButton.style.display = 'block';
        }

        // --- EVENT LISTENERS ---
        // Keyboard controls
        window.addEventListener('keydown', ({ key }) => {
            if (!gameRunning) return;
            switch (key) {
                case 'ArrowLeft':
                case 'a':
                    keys.left.pressed = true;
                    break;
                case 'ArrowRight':
                case 'd':
                    keys.right.pressed = true;
                    break;
                case ' ':
                    player.isShooting = true;
                    break;
            }
        });

        window.addEventListener('keyup', ({ key }) => {
            switch (key) {
                case 'ArrowLeft':
                case 'a':
                    keys.left.pressed = false;
                    break;
                case 'ArrowRight':
                case 'd':
                    keys.right.pressed = false;
                    break;
                case ' ':
                    player.isShooting = false;
                    break;
            }
        });

        // Touch controls for mobile
        let touchStartX = null;
        let playerStartX = null;
        
        canvas.addEventListener('touchstart', (e) => {
            if (!gameRunning) return;
            e.preventDefault();
            player.isShooting = true; // Auto-shoot on touch
            touchStartX = e.touches[0].clientX;
            playerStartX = player.position.x;
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            if (!gameRunning || touchStartX === null) return;
            e.preventDefault();
            const touchX = e.touches[0].clientX;
            const deltaX = touchX - touchStartX;
            player.position.x = playerStartX + deltaX;
        }, { passive: false });

        canvas.addEventListener('touchend', (e) => {
            if (!gameRunning) return;
            e.preventDefault();
            player.isShooting = false;
            touchStartX = null;
        });


        // Restart button
        restartButton.addEventListener('click', () => {
            init();
            animate();
        });
        
    </script>
</body>
</html>
